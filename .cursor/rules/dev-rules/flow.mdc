---
description: 本规则定义了VibeCopilot的强制开发流程检查点，确保开发过程遵循标准化流程。应在以下情况下应用：(1)启动功能开发前，(2)提交代码前，(3)发起合并请求前，(4)发布版本前。规则负责在workflow-flow定义的生命周期中执行强制性验证，保证项目质量和流程规范性。
globs: ["*.ts", "*.tsx", "*.js", "*.jsx", "*.py", "*.md"]
alwaysApply: true
---
# VibeCopilot 强制开发流程检查点

## 规则关系
本规则与`flow-command.mdc`紧密配合：
- `flow.mdc`（本规则）定义开发流程中的强制检查点和验证标准
- `flow-command.mdc`定义流程命令的执行方式和交互逻辑

## 核心定位
- 本规则为强制执行规则，确保开发者不能绕过流程
- 与workflow-instruction配合使用，flow为强制性检查点，workflow为具体指导
- 提及流程规则但不执行时，使用`{/flow}`格式

## 开发流程强制检查点

### PRE-FLOW阶段（需求确认）
- **强制检查点 1**：开始任何开发前，必须有story-flow生成的Approved状态PRD文档
- **强制检查点 2**：PRD必须包含验收标准和优先级
- **检查方式**：`/check prd <功能名称>`
- **不合规处理**：阻止创建开发分支，退回到PRE-FLOW阶段

### FLOW阶段入口
- **强制检查点 3**：必须有spec-flow制定并批准的开发计划
- **强制检查点 4**：开发计划必须包含技术选型、架构设计和任务分解
- **检查方式**：`/check plan <功能名称>`
- **不合规处理**：阻止开始编码工作，要求完善开发计划

### 开发阶段（编码）
- **强制检查点 5**：必须在任务分支上进行开发，不能直接在主分支修改
- **强制检查点 6**：代码提交必须遵循Conventional Commits规范并关联任务ID
- **强制检查点 7**：代码文件不得超过200行
- **强制检查点 8**：必须编写单元测试，覆盖关键功能
- **检查方式**：提交前自动检查
- **不合规处理**：拒绝代码提交，提示修正

### 测试阶段
- **强制检查点 9**：整体测试覆盖率必须≥70%
- **强制检查点 10**：核心功能测试覆盖率必须≥85%
- **强制检查点 11**：必须通过所有自动化测试
- **检查方式**：`/check test <功能名称>`
- **不合规处理**：阻止进入审核阶段，要求增加测试

### 审核阶段
- **强制检查点 12**：必须通过代码审核，解决所有严重问题
- **强制检查点 13**：必须编写用户指南和开发指南
- **强制检查点 14**：API必须有完整文档
- **检查方式**：`/check review <功能名称>`
- **不合规处理**：阻止提交合并，要求完善

### 提交阶段
- **强制检查点 15**：合并前必须更新CHANGELOG.md
- **强制检查点 16**：必须使用正确的分支合并策略（--no-ff）
- **强制检查点 17**：合并前必须解决所有冲突
- **强制检查点 18**：合并后必须关闭对应任务并更新状态
- **检查方式**：合并操作前自动检查
- **不合规处理**：阻止合并操作

### POST-FLOW阶段
- **强制检查点 19**：必须记录项目经验教训
- **强制检查点 20**：更新相关规则（如需要）
- **检查方式**：`/check post <功能名称>`
- **不合规处理**：标记项目技术债，要求后续补充

## 命令注释用法
使用`{/flow}`格式表示提及流程规则而非执行：
```
讨论流程规则时，使用{/flow}表示提及规则而非执行，例如：
"关于{/flow}规则，它定义了开发流程必须遵循的检查点"
```

## 紧急处理流程
在特殊情况下需要绕过流程时：
- 绕过记录自动存档，需在48小时内补齐流程
- 连续3次紧急处理将触发流程审查

## 流程检查示例

<example>
  # 流程强制执行示例

  ## PRE-FLOW检查

  ```bash
  # 尝试创建开发分支而没有approved的PRD
  $ git checkout -b feature/user-auth
  ❌ 流程错误: 未发现用户认证功能的Approved PRD
  🔄 请使用 /story 命令创建并完成PRD

  # 正确流程
  $ /check prd user-auth
  ✅ PRD状态: Approved (user-auth.md)
  ✅ 可以继续开发流程
  ```

  ## 开发计划检查

  ```bash
  # 尝试开始编码但没有开发计划
  $ /task start coding user-auth
  ❌ 流程错误: 未发现用户认证功能的开发计划
  🔄 请先使用 /plan 命令制定开发计划
  ```
</example>
