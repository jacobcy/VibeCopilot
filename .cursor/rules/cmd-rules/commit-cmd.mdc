---
description: 当用户输入/commit命令时，执行规范化的代码提交操作，确保符合项目提交标准
globs:
alwaysApply: false
---

# VibeCopilot 代码提交命令处理器

## 命令目的
`/commit`命令提供标准化的代码提交体验，确保提交符合项目规范，并与任务、分支系统集成。

## 规则关系
本命令规则与以下规则紧密配合：
- `flow.mdc`: 遵循流程检查点，确保提交前满足强制检查
- `branch-cmd.mdc`: 确保在正确的任务分支上进行提交
- `commit-flow.mdc`: 实现提交流程规范
- `git-commit-push-agent.mdc`: 应用具体的Git提交格式规范

## 命令格式规范
基本语法: `/commit "<提交信息>" [参数]`

参数说明:
- `--task=<ID>`: 关联的任务ID，不提供时尝试使用当前分支关联的任务
- `--type=<类型>`: 提交类型(feat, fix, docs等)，不提供时从消息解析
- `--push`: 提交后自动推送到远程
- `--skip-check`: 跳过部分检查(谨慎使用)

## 命令执行流程
```mermaid
flowchart TD
    A[开始] --> B[检查当前分支]
    B --> C{是任务分支?}
    C -->|是| D[检查流程前置条件]
    C -->|否| E[提示切换分支]
    D --> F{条件满足?}
    F -->|是| G[格式化提交信息]
    F -->|否| H[显示条件不满足]
    G --> I[执行提交操作]
    I --> J{指定了push?}
    J -->|是| K[推送到远程]
```

## 提交前检查清单
1. 确认在正确的任务分支上
2. 检查代码是否通过静态分析
3. 验证测试是否通过
4. 确认提交信息符合规范
5. 验证关联了正确的任务ID

## 提交信息格式
自动格式化为：`type(scope): description [task-id]`
- 类型(type)从命令参数或提交信息中提取
- 如未指定任务ID，自动从当前分支关联任务获取

## 示例

<example>
  用户: `/commit "实现用户认证API功能" --task=T2.1 --push`

  系统响应:
  ```
  ✅ 提交成功!

  提交信息: feat(auth): 实现用户认证API功能 [T2.1]
  分支: feature/T2.1-user-authentication

  Git操作:
  - 已暂存 3个文件
  - 已提交 SHA: a1b2c3d
  - 已推送到远程仓库

  任务 T2.1 状态已更新为"进行中"
  ```

  用户: `/commit "修复登录页面在移动端显示错误的问题"`

  系统响应:
  ```
  ✅ 提交成功!

  提交信息: fix(ui): 修复登录页面在移动端显示错误的问题 [T2.1]
  分支: feature/T2.1-user-authentication

  Git操作:
  - 已暂存 1个文件
  - 已提交 SHA: e4f5g6h
  - 未推送到远程仓库

  提示: 使用 /commit --push 自动推送到远程
  ```
</example>

<example type="invalid">
  用户: `/commit "添加了一些代码"`

  系统响应:
  ```
  ❌ 提交信息不符合规范

  提交信息必须清晰描述更改内容，并且:
  1. 应包含更改类型(feat, fix等)
  2. 描述必须具体明确

  建议格式: "feat: 添加用户登录功能" 或 "fix: 修复数据加载错误"
  ```

  用户: `/commit "feat: 添加用户注册功能"`

  系统响应:
  ```
  ❌ 分支检查失败

  当前分支 'main' 不是任务分支，不能直接提交。

  请先:
  1. 使用 /branch --create --task=<任务ID> 创建任务分支
  2. 或使用 /branch --switch 切换到现有任务分支
  ```
</example>

## 实现细节

### 分支与任务集成
- 自动检测当前分支关联的任务
- 确保提交信息中包含任务ID
- 根据提交内容更新任务状态和进度

### 提交前检查
- 检查代码格式和质量
- 验证测试是否通过
- 确认没有遗留的临时代码
- 检查是否有未解决的合并冲突

### 提交后操作
- 可选自动推送到远程
- 更新任务状态和进度
- 记录提交历史和统计数据
