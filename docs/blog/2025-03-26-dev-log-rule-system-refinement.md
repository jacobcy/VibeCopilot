---
title: 开发日志：规则系统拆分、定义与优化 (2025-03-26)
author: Jacob
date: 2025-03-26
tags: 开发, 规则系统, 架构, 模板, 开发流程, VibeCopilot
category: 开发日志
status: 已完成
summary: 本日志记录了 VibeCopilot 规则系统的重大重构过程，包括将主规则拆分为约定和配置规则、定义规则生成器、优化开发流程规则以及完善专家代理规则。
---

# 开发日志：规则系统拆分、定义与优化 (2025-03-26)

> 本日志记录了 VibeCopilot 规则系统的重大重构过程，包括将主规则拆分为约定和配置规则、定义规则生成器、优化开发流程规则以及完善专家代理规则。
>
> 作者: Jacob | 日期: 2025-03-26 | 状态: 已完成

## 背景与目标

随着 VibeCopilot 项目的发展，原有的单一主规则文件 (`@vibe_main.mdc`) 难以承载日益复杂的项目约定和配置。同时，需要对核心的开发流程规则和专家代理规则进行优化，并建立一套标准化的规则生成机制。主要目标包括：

- **规则包拆分**: 将 `@vibe_main.mdc` 拆分为更专注的规则文件，实现配置与约定的分离。
- **规则生成器定义**: 在 `@rule.mdc` 中明确规则的类型、模板、执行流程、质量标准和存储规范。
- **开发流程优化**: 改进与开发流程相关的规则（如 `@flow.mdc`, `@story-agent.mdc`, `@doc-agent.mdc`, `@spec-agent.mdc`），提高清晰度和可操作性。
- **专家代理完善**: 确保专家代理规则（如 `@coding-agent.mdc`）得到优化和正确应用。

## 技术方案与实施

### 规则包拆分与内容整合

- **分析 `@vibe_main.mdc`**: AI 助手读取并分析了原有主规则的内容。
- **创建新规则文件**: 成功将 `@vibe_main.mdc` 拆分为：
  - `vibe_convention.mdc`: 包含通用的开发约定、五步法流程、沟通原则、命名规范、文档标准、质量要求、Git 规范和反模式避免等。
  - `vibe_config.mdc`: 包含项目特定的技术栈配置、目录结构、环境变量、工具链、外部集成（Claude, GitHub, GitDiagram）和 MCP 服务器配置等。
- **内容整合**: 根据用户提供的额外内容（五步法、沟通原则、反模式），AI 助手将其整合进 `vibe_convention.mdc`，并确保了结构清晰。
- **生成摘要**: 根据用户要求，为 `vibe_convention.mdc` 生成了简洁的摘要，方便快速理解核心要点。

### 规则生成器定义 (`@rule.mdc`)

- **初步定义**: AI 助手根据用户请求，在 `@rule.mdc` 中创建了规则类型、模板和执行结果的初步定义。
- **分类细化**: 根据用户反馈，对规则类型进行了重新分类，引入了 `command-rules`, `custom-rules`, `core-rules`, `dev-rules`, `role-rules`, `tech-rules`, `tool-rules` 等更细致的分类。
- **质量与存储规范**: 根据用户要求，在 `@rule.mdc` 中添加了关于规则文件长度限制、内容相关性等质量标准，并明确了不同类型规则的存储路径和命名约定（如 `command-rules/flow-command.mdc`）。
- **移除无关内容**: 删除了关于规则维护流程等与核心定义无关的部分。

### 开发流程与专家代理规则优化

- **流程规则优化**: 对 `@flow.mdc` 等流程相关规则进行了优化，提升了清晰度。（具体优化细节未在摘要中完全体现）
- **专家代理规则**: 优化了 `@coding-agent.mdc` 等专家代理规则。（具体优化细节未在摘要中完全体现）
- **Spec Agent 规则明确**: 识别并向用户展示了 `@spec-agent.mdc` 的内容，该规则定义了 VibeCopilot 的开发计划标准，包括项目管理、分支管理和测试要求。

## 开发过程

该阶段的工作主要围绕规则系统的重构和细化展开：

1. **拆分请求**: 用户提出将主规则拆分的需求。
2. **执行拆分**: AI 读取、分析并创建了新的约定和配置规则文件。
3. **内容补充**: 用户提供补充内容，AI 将其整合进新文件。
4. **生成器定义**: 用户提出定义规则生成器的需求，AI 创建初步定义。
5. **迭代完善**: 用户根据需要，多次提出修改请求（分类、质量标准、存储规范），AI 逐步完善 `@rule.mdc`。
6. **流程优化**: 用户提出优化开发流程相关规则。
7. **执行优化**: AI 对相关流程和代理规则进行编辑优化。

## 测试与验证

- **文件创建与内容**: 通过检查新创建的规则文件 (`vibe_convention.mdc`, `vibe_config.mdc`, `@rule.mdc` 等) 的内容和结构，验证是否符合用户要求。
- **规则分类与规范**: 确认 `@rule.mdc` 中定义的规则分类、质量标准、存储路径和命名约定已按要求更新。
- **流程规则审查**: (推测) 用户和 AI 可能对优化后的流程规则进行了审查，确保其清晰度和可行性。

## 经验总结

- **规则模块化**: 将大型、笼统的规则拆分为更小、更专注的模块（如约定 vs 配置）有助于提高可维护性和清晰度。
- **标准化元规则**: 定义一套关于“如何编写和管理规则”的元规则（如 `@rule.mdc`）对于维护大型规则系统至关重要。
- **迭代式完善**: 规则系统的构建是一个迭代过程，需要根据实际使用反馈不断调整和完善分类、标准和规范。
- **明确职责**: 清晰定义不同规则（流程规则、代理规则、配置规则等）的职责范围有助于避免混淆。

## 后续计划

- [ ] 根据 `@rule.mdc` 中定义的规范，整理和迁移现有的所有规则文件。
- [ ] 实现或完善基于 `@rule.mdc` 中定义的模板生成规则文件的工具或流程。
- [ ] 在实际开发中应用优化后的开发流程和专家代理规则。

## 参考资料

- 相关规则文件: `@vibe_main.mdc` (原始), `vibe_convention.mdc`, `vibe_config.mdc`, `@rule.mdc`, `@flow.mdc`, `@story-agent.mdc`, `@doc-agent.mdc`, `@spec-agent.mdc`, `@coding-agent.mdc`
