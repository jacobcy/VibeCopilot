# VibeCopilot Cursor规则详细指南

> **适用对象**: 本指南适用于已了解Cursor规则基本概念，需要进一步深入了解规则系统的开发者。如果你是初次接触Cursor规则，请先阅读[快速入门指南](README.md)。

## 一、规则系统架构

VibeCopilot规则系统采用模块化设计，所有规则均存储在`.cursor/rules/`目录下，按功能分类组织：

```
.cursor/rules/
├── core-rules/       # 核心规则和规则生成器
├── global-rules/     # 全局应用规则
├── tool-rules/       # 工具使用规则
├── ts-rules/         # TypeScript规则
├── ui-rules/         # UI开发规则
└── workflows/        # 工作流规则
```

规则通过`.mdc`文件定义，使用Markdown格式并包含YAML前置元数据。

## 二、规则类型详解

### 1. 代理选择型规则 (Agent Selected)

这类规则由AI根据上下文自动选择是否应用，特别适合特定开发场景。

**元数据配置**:
```yaml
---
description: [详细说明规则适用场景的描述]
globs: [留空]
alwaysApply: false
---
```

**示例规则**: `core-rules/typescript-best-practices-agent.mdc`

**适用场景**:

- 代码审查标准
- 架构设计指南
- 技术选型原则

**如何生效**:
AI会根据description字段判断是否适用当前场景，description越详细越好。

### 2. 全局规则 (Always)

这类规则应用于所有对话场景，无需显式调用。

**元数据配置**:
```yaml
---
description: [留空]
globs: [留空]
alwaysApply: true
---
```

**示例规则**: `global-rules/emoji-communication-always.mdc`

**适用场景**:

- 通用沟通风格
- 项目通用标准
- 基础代码格式

**如何生效**:
自动应用于每个对话和cmd-k请求。

### 3. 自动应用规则 (Auto Select)

这类规则根据文件类型自动应用，特别适合特定文件格式的处理标准。

**元数据配置**:
```yaml
---
description: [可选描述]
globs: [文件匹配模式，如*.ts]
alwaysApply: false
---
```

**示例规则**: `ts-rules/typescript-imports-auto.mdc`

**适用场景**:

- 特定语言编码标准
- 文件格式规范
- 特定框架使用规则

**如何生效**:
当打开匹配globs模式的文件时自动应用。

### 4. 手动规则 (Manual)

这类规则需要在对话中明确引用才会生效。

**元数据配置**:
```yaml
---
description: [留空]
globs: [留空]
alwaysApply: false
---
```

**示例规则**: `workflows/workflow-agile-manual.mdc`

**适用场景**:

- 特定工作流程
- 按需应用的标准
- 临时性指导

**如何生效**:
在对话中使用`@规则名`格式显式调用。

## 三、规则调用详解

### 1. 单一规则调用

基本格式: `@规则名 [请求内容]`

```
@vibe-workflow-agent 帮我生成一个新功能的实现计划，包括前端组件和API接口
```

```
@ts-best-practices 请检查这段代码是否符合我们项目的TypeScript标准
```

**注意事项**:

- 规则名称区分大小写
- @符号必须紧贴规则名
- 规则名后要有空格

### 2. 多规则组合调用

基本格式: `@规则名1 @规则名2 [请求内容]`

```
@vibe-workflow-agent @ts-best-practices 帮我设计并实现一个符合TypeScript标准的API服务
```

**优先级规则**:

- 手动规则 > 自动规则
- 特定规则 > 通用规则
- 后调用规则 > 先调用规则

### 3. 专业代理调用高级技巧

#### 方法一: 辅助规则调用

```
@helper-use-custom-agents 我需要架构设计专家帮我设计一个微服务架构，要求高可用性和水平扩展
```

```
@helper-use-custom-agents 请以前端开发专家的身份帮我优化这个React组件的性能，重点关注重渲染问题
```

#### 方法二: 直接角色描述

```
请以需求分析专家的身份，帮我从这个模糊的需求中提取关键用户故事和功能点
```

```
我需要你用质量保障专家的角度审查这段代码，特别关注边界情况和异常处理
```

#### 高级提示

- 提供明确的专业领域
- 描述具体的任务要求
- 指明关注重点
- 一次只使用一个专业角色

## 四、规则创建最佳实践

### 1. 规则设计原则

高质量规则应遵循以下原则:

- **单一责任**: 每个规则专注于一个方面
- **简洁明了**: 保持规则简短(25-50行)
- **具体示例**: 提供有效和无效示例
- **描述清晰**: Agent规则描述要详细具体
- **适当约束**: 不要过度限制创造性

### 2. 规则创建流程

```
1. 确定规则类型: 决定使用哪种规则类型最合适
2. 明确使用场景: 定义规则的具体适用场景
3. 编写规则内容: 包括必要的指导和示例
4. 测试规则效果: 在实际场景中验证规则
5. 迭代优化: 根据使用效果不断改进
```

### 3. 规则内容结构

推荐的规则内容结构:

```markdown
# 规则标题

## 关键规则
- 简洁的规则条目1
- 简洁的规则条目2
- ...

## 示例
<example>
有效的规则应用示例
</example>

<example type="invalid">
无效的规则应用示例
</example>
```

## 五、高级规则应用场景

### 1. 工作流集成规则

工作流规则帮助你实施结构化开发流程，如敏捷开发、文档先于代码等。

**代表规则**: `vibe-workflow-agent`

**使用技巧**:
```
@vibe-workflow-agent 帮我基于这个需求创建完整开发计划，包括设计、实现和测试阶段
```

### 2. 代码质量规则

确保代码符合项目标准和最佳实践。

**代表规则**: `ts-best-practices`

**使用技巧**:
```
@ts-best-practices 检查以下代码是否符合我们的命名约定、错误处理和性能标准
```

### 3. 文档标准规则

维护一致的文档质量和格式。

**代表规则**: `vibe-documentation-format`

**使用技巧**:
```
@vibe-documentation-format 帮我创建一个API文档，包含标准章节和示例
```

### 4. 代码审查规则

提供结构化的代码审查指导。

**代表规则**: `code-review-workflow`

**使用技巧**:
```
@code-review-workflow 帮我审查这段代码，关注安全性、可维护性和性能
```

## 六、规则冲突处理

### 1. 常见冲突类型

- **优先级冲突**: 多个规则给出不同指导
- **范围冲突**: 规则适用范围重叠
- **版本冲突**: 规则与当前项目阶段不符

### 2. 解决方案

- **明确优先级**: 显式指定哪个规则优先
- **上下文说明**: 提供更多上下文信息
- **临时修改**: 说明特定情况下的规则变通
- **创建修正规则**: 为冲突情况创建专门规则

```
在这个特殊情况下，请优先考虑@code-review-workflow而不是@ts-best-practices中关于注释的要求
```

## 七、专业代理能力详解

### 1. 需求分析专家

**专长**: PRD文档、用户故事、需求分析
**典型任务**:

- 创建详细PRD文档
- 提取用户故事和功能点
- 定义验收标准
- 需求优先级排序

**高效使用提示**:
```
请以需求分析专家的视角，分析这个产品概念并生成结构化PRD，包含用户场景、功能列表和非功能需求
```

### 2. 架构设计专家

**专长**: 系统架构、技术选型、组件设计
**典型任务**:

- 创建系统架构图
- 定义组件接口
- 技术选型决策
- 数据流设计

**高效使用提示**:
```
请以架构设计专家的身份，设计一个支持高并发的微服务架构，包含关键组件、数据流和技术选型理由
```

### 3. 前端开发专家

**专长**: UI实现、前端框架、状态管理
**典型任务**:

- 组件设计与实现
- 状态管理方案
- 性能优化
- 响应式布局

**高效使用提示**:
```
请以前端开发专家的身份，实现这个复杂表单组件，需要处理多级联动和异步验证
```

### 4. 后端开发专家

**专长**: API设计、数据模型、服务实现
**典型任务**:

- REST/GraphQL API设计
- 数据库模型设计
- 业务逻辑实现
- 性能和安全优化

**高效使用提示**:
```
请以后端开发专家的身份，设计一个用户认证服务的API和数据模型，支持多因素认证
```

### 5. 文档专家

**专长**: 技术文档、API文档、使用指南
**典型任务**:

- API文档编写
- 开发者指南创建
- 最佳实践总结
- 使用教程编写

**高效使用提示**:
```
请以文档专家的身份，为这个API创建详细文档，包含每个端点的说明、参数、返回值和示例
```

### 6. 质量保障专家

**专长**: 测试策略、代码审查、质量标准
**典型任务**:

- 测试计划设计
- 代码审查
- 质量指标定义
- 自动化测试实现

**高效使用提示**:
```
请以质量保障专家的身份，为这个功能设计全面的测试计划，包括单元测试、集成测试和端到端测试
```

## 八、高级使用技巧

### 1. 规则链接与上下文传递

连续使用规则时保持上下文:

```
@vibe-workflow-agent 帮我规划这个新功能的实现

[AI回答]

现在请用@ts-best-practices检查我刚写的实现方案
```

### 2. 规则范围限定

限制规则应用的范围:

```
@ts-best-practices 只检查代码中关于错误处理的部分
```

### 3. 临时规则定制

针对特定情况临时调整规则:

```
这次实现暂时不考虑@ts-best-practices中关于详细注释的要求，因为这是原型代码
```

### 4. 规则组合优化

组合多个规则实现复杂目标:

```
@vibe-workflow-agent创建实现计划，然后@vibe-documentation-format为API编写文档
```

## 九、故障排除指南

### 1. 规则加载问题

| 问题 | 解决方法 |
|------|--------|
| 规则文件找不到 | 检查`.cursor/rules/`目录中是否存在该规则文件 |
| 规则格式错误 | 验证.mdc文件的YAML前置元数据格式 |
| 多个同名规则 | 检查不同目录下是否有同名规则文件 |

### 2. 规则应用问题

| 问题 | 解决方法 |
|------|--------|
| 自动规则不触发 | 检查globs模式是否匹配当前文件 |
| 手动规则无效 | 确保@符号使用正确，检查规则名大小写 |
| 规则效果不符预期 | 查看规则内容，可能需要更新或优化规则 |

### 3. AI响应问题

| 问题 | 解决方法 |
|------|--------|
| AI忽略规则要求 | 明确引用规则名，提供更多上下文 |
| AI混合多个规则 | 一次只使用一个专业代理，避免角色混淆 |
| AI回答不一致 | 重新开始对话，确保上下文清晰 |

## 十、规则资源

### 1. 内置规则目录

- **Core Rules**: `.cursor/rules/core-rules/`
- **TypeScript Rules**: `.cursor/rules/ts-rules/`
- **Workflow Rules**: `.cursor/rules/workflows/`
- **Global Rules**: `.cursor/rules/global-rules/`

### 2. 规则模板

创建新规则时可使用标准模板:
`.cursor/templates/rule_template.mdc`

### 3. 常用规则存储位置

- **项目级规则**: `.cursor/rules/`
- **用户级规则**: `~/Library/Application Support/cursor/rules/` (macOS)
- **临时规则**: 可直接在对话中创建

---

🧩 本指南详细介绍了VibeCopilot项目中Cursor规则的高级用法。灵活运用这些规则，将显著提升你的开发效率和代码质量。如有疑问，请随时使用`@help`命令获取帮助。
